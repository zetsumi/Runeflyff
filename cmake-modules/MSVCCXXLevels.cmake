SET(MSVC_CXX20_FLAG "/std:c++20")
SET(MSVC_CXX17_FLAG "/std:c++17")
SET(MSVC_CXX14_FLAG "/std:c++14")

CHECK_CXX_COMPILER_FLAG(${MSVC_CXX20_FLAG} MSVC_SUPPORTS_CXX20)
CHECK_CXX_COMPILER_FLAG(${MSVC_CXX17_FLAG} MSVC_SUPPORTS_CXX17)
CHECK_CXX_COMPILER_FLAG(${MSVC_CXX14_FLAG} MSVC_SUPPORTS_CXX14)
SET(MSVC_SUPPORTS_CXX11 MSVC_VERSION > 1500)

IF (MSVC_SUPPORTS_CXX20)
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${MSVC_CXX20_FLAG}")
ELSEIF (MSVC_SUPPORTS_CXX17)
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${MSVC_CXX17_FLAG}")
ELSEIF (MSVC_SUPPORTS_CXX14)
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${MSVC_CXX14_FLAG}")
ELSEIF (MSVC_SUPPORTS_CXX11)
    MESSAGE(WARNING "The compiler ${CMAKE_CXX_COMPILER} has limited C++11 support. Consider using Visual Studio 2017 or later.")
ENDIF()

SET(COMPILER_SUPPORTS_CXX20 MSVC_SUPPORTS_CXX20)
SET(COMPILER_SUPPORTS_CXX17 COMPILER_SUPPORTS_CXX20 OR MSVC_SUPPORTS_CXX17)
SET(COMPILER_SUPPORTS_CXX14 COMPILER_SUPPORTS_CXX17 OR MSVC_SUPPORTS_CXX14)
SET(COMPILER_SUPPORTS_CXX11 COMPILER_SUPPORTS_CXX14 OR MSVC_SUPPORTS_CXX11)